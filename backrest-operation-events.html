<script type="text/javascript">
    RED.nodes.registerType('backrest-operation-events', {
        category: 'backrest',
        color: "#e2d96e",
        defaults: {
            name: { value: "" },
            config: { type: "backrest-config", required: true },
            listenValue: { value: "payload", required: false },
            listenType: { value: "msg", required: false }
        },
        inputs: 1,
        outputs: 1,
        icon: "node-red-contrib-backrest-logo.png",
        paletteLabel: "Operation Events",
        label: function() {
            return this.name || "Operation Events";
        },
        oneditprepare: function() {
            // Setup typed input for "listenValue"
            $("#node-input-listenValue").typedInput({
                types: ["msg","flow","global","str","jsonata","bool","num"],
                typeField: "#node-input-listenType"
            });
        },
        oneditsave: function() {
            // Ensure we store the typed input fields
            this.listenValue = $("#node-input-listenValue").typedInput("value");
            this.listenType  = $("#node-input-listenValue").typedInput("type");
        }
    });
</script>

<script type="text/html" data-template-name="backrest-operation-events">
    <div class="form-row">
        <label for="node-input-name">
            <i class="fa fa-tag"></i> Name
        </label>
        <input type="text" id="node-input-name" />
    </div>

    <div class="form-row">
        <label for="node-input-config">
            <i class="fa fa-cog"></i> Backrest Config
        </label>
        <input type="text" id="node-input-config" />
    </div>

    <div class="form-row">
        <label for="node-input-listenValue">
            <i class="fa fa-play"></i> Start Listening?
        </label>
        <input type="text" id="node-input-listenValue" style="width:60%;" />
        <input type="hidden" id="node-input-listenType" />
        <div style="margin-left:5px;">
            <small>Evaluates to <strong>true</strong> to subscribe, <strong>false</strong> to unsubscribe.</small>
        </div>
    </div>
</script>
